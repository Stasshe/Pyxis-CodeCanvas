【不具合調査報告書】

■ 件名
react/performance-improvement ブランチにおける不具合の原因と対策について

■ 日時
2026年01月27日

■ 対象ブランチ
react/performance-improvement

■ 報告概要
当該ブランチ適用後に発生していた「ペイン間の同期不良」「未保存マーカー(isDirty)の不整合」「アクティブタブ表示の異常」について調査を行いました。
Gitのコミット履歴比較（diff）とコード解析の結果、パフォーマンス最適化のために導入された変更が副作用を引き起こしていることを特定しました。

■ 確認された不具合
1. 複数のペインで同じファイルを開いている際、一方の編集内容が他方に即時反映されない。
2. ファイルを編集しても、タブバーの未保存マーカー（isDirty・緑の丸）が更新されない、または消えない。
3. 非アクティブなタブであるにもかかわらず、アクティブを示す緑の線が表示される場合がある。

■ 原因
`src/engine/editor/EditorMemoryManager.ts` に対する変更が直接の原因です。

詳細:
パフォーマンス改善（再レンダリングの抑制）を目的として、`EditorMemoryManager` クラス内の `syncToTabStore` メソッドが廃止され、代わりに `syncDirtyFlagToTabStore` が実装されました。

- **変更前**: コンテンツが変更されると、`tabStore`（グローバル状態）に対して「コンテンツ」と「isDirtyフラグ」の両方を同期していました。
- **変更後**: `tabStore` への「コンテンツ」の同期を停止し、「isDirtyフラグ」のみを更新する仕様に変更されました。

Monaco Editorなどのエディタコンポーネントは、コンテンツの更新を `tabStore` 経由で検知する設計となっているため、この変更によりデータフローが遮断され、同期不良が発生しました。また、タブID生成ロジックと状態管理の不整合により、アクティブタブ判定にも影響が及びました。

■ 対策
過度な最適化を一部巻き戻し、正しい同期処理を復元します。

`src/engine/editor/EditorMemoryManager.ts` を修正し、コンテンツの変更があった際に `tabStore` へもデータを同期する処理（`updateTabContent` の呼び出し）を復活させます。これにより、全てのペインが最新の状態を維持できるようになります。

■ 今後の予定
本レポート提出後、直ちに修正コードの実装と検証を行います。

以上
