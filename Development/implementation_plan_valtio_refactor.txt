【実装計画書】ZustandからValtioへの移行（リファクタリング）

■ 目的
現在のZustandベースの `tabStore` と、手動最適化層である `EditorMemoryManager` を廃止し、`Valtio` による状態管理へ一本化する。
これにより、複雑なレンダリング最適化ロジックを排除し、Valtioの自動依存追跡による高パフォーマンスとコードの簡素化を両立させる。

■ 背景
現在の実装では、パフォーマンス確保のためにエディタの内容（content）を `EditorMemoryManager` という独自クラスで管理し、`tabStore` と切り離していた。
しかし、これ（同期ロジック）がバグの温床となり、今回の同期不具合を引き起こした。
Valtioを採用することで、オブジェクトを直接操作するようなシンプルな記述で、必要な箇所だけを正確に再レンダリングさせることが可能となる。

■ 実装手順

1. パッケージのインストール
   - `valtio` をプロジェクトに追加する

2. 新しいストアの作成 (`src/stores/tabState.ts`)
   - `proxy` を使用して状態オブジェクトを定義する
   - `panes` や `activePane` などの状態定義を移行する
   - `content` も `Tab` オブジェクト内に直接持たせる（`EditorMemoryManager` は使わない）
   - アクション（`openTab`, `updateTabContent` 等）を関数として実装する

3. コンポーネントの修正
   - `PaneContainer.tsx`: `useTabStore` を `useSnapshot` に置き換え、レンダリング範囲を最適化する
   - `TabBar.tsx`: `useSnapshot` を使用してタブ一覧を表示する
   - `CodeEditor.tsx` / `MonacoEditor.tsx`:
     - `content` の読み取りには `useSnapshot` を使用（変更箇所のみ再描画される）
     - 編集時の書き込みは、プロキシオブジェクトを直接操作する（Zustandのsetは不要）

4. 不要化されたコードの削除
   - `src/stores/tabStore.ts` (Zustand版) を削除
   - `src/engine/editor/EditorMemoryManager.ts` を削除
   - `useMonacoModels.ts` 内のキャッシュロジックも、必要に応じてシンプル化する

■ 検証計画

1. 基本動作の確認
   - ファイルを開けること
   - タブの切り替えができること
   - ペイン分割ができること

2. 同期の確認（今回のバグ修正確認）
   - 画面を左右に分割し、同じファイルを開く
   - 片方で入力した文字が、もう片方に即座に反映されること
   - この際、`CodeEditor` 以外のコンポーネント（`TabBar` や親の `PaneContainer`）が無駄に再レンダリングされていないことをReact DevToolsで確認する

3. `isDirty` の確認
   - 編集時にタブの未保存マークが表示されること
   - 保存（Ctrl+S）でマークが消えること

■ スケジュール
本計画の承認後、直ちに着手し、本日中の完了を目指す。
